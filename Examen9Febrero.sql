create database BDExamen2DMLDaw1;
use BDExamen2DMLDaw1;

/* TABLAS PERSONAL, PROFESORES Y CENTROS */

CREATE TABLE CENTROS (
 COD_CENTRO   INT PRIMARY KEY,
 TIPO_CENTRO  CHAR(1),
 NOMBRE VARCHAR(30),
 DIRECCION VARCHAR(26),
 TELEFONO VARCHAR(10),
 NUM_PLAZAS INT
 );


INSERT INTO CENTROS VALUES (10,'S','IES El Quijote', 'Avda. Los Molinos 25', '965-887654',538);
INSERT INTO CENTROS VALUES (15,'P','CP Los Danzantes', 'C/Las Musas s/n','985-112322',250);
INSERT INTO CENTROS VALUES (22,'S', 'IES Planeta Tierra', 'C/Mina 45','925-443400',300);
INSERT INTO CENTROS VALUES (45,'P', 'CP Manuel Hidalgo', 'C/Granada 5','926-202310',220);
INSERT INTO CENTROS VALUES (50,'S', 'IES Antoñete', 'C/Los Toreros 21','989-406090',310);

SELECT * FROM CENTROS;

CREATE TABLE AULAS (
 COD_CENTRO INT,
 NUMEROAULA INT,
 CANTIDADHORAS INT,
 PRIMARY KEY(COD_CENTRO, NUMEROAULA),
FOREIGN KEY (COD_CENTRO) REFERENCES CENTROS(COD_CENTRO) 
);

INSERT INTO AULAS VALUES (10,111, 220);
INSERT INTO AULAS VALUES (10,112, 222);
INSERT INTO AULAS VALUES (10, 113, 223);
INSERT INTO AULAS VALUES (15,114, 205);
INSERT INTO AULAS VALUES (15, 115, 204);
INSERT INTO AULAS VALUES (15, 116, 210);
INSERT INTO AULAS VALUES (22, 117, 270);
INSERT INTO AULAS VALUES (45, 118, 241);
INSERT INTO AULAS VALUES (10,119, 180);
INSERT INTO AULAS VALUES (15,120, 190);
INSERT INTO AULAS VALUES (15,121, 199);
INSERT INTO AULAS VALUES (22,122, 180);
INSERT INTO AULAS VALUES (22, 123, 170);
INSERT INTO AULAS VALUES (45, 124, 170);


CREATE TABLE PROFESORES (
COD_CENTRO   INT NOT NULL,
DNI INT,
APELLIDOS VARCHAR(80),
ESPECIALIDAD VARCHAR(50),
PRIMARY KEY(COD_CENTRO, DNI),
FOREIGN KEY (COD_CENTRO) REFERENCES AULAS(COD_CENTRO)
);


INSERT INTO PROFESORES VALUES (10, 1112345, 'Martínez Salas, Fernando','INFORMÁTICA');
INSERT INTO PROFESORES VALUES (10,4123005,'Bueno Zarco, Elisa', 'MATEMÁTICAS');
INSERT INTO PROFESORES VALUES (10,4122025,'Montes García, M.Pilar', 'MATEMÁTICAS');
INSERT INTO PROFESORES VALUES (15,9800990, 'Ramos Ruiz, Luis','LENGUA');
INSERT INTO PROFESORES VALUES (15,1112345,'Rivera Silvestre, Ana','DIBUJO');
INSERT INTO PROFESORES VALUES (15,8660990, 'De Lucas Fdez, M.Angel','LENGUA');
INSERT INTO PROFESORES VALUES (22,7650000, 'Ruiz Lafuente, Manuel','MATEMÁTICAS');
INSERT INTO PROFESORES VALUES (45,43526789, 'Serrano Laguía, María','INFORMÁTICA');


-------------------
1.
SELECT C.NOMBRE,COUNT(P.DNI)
FROM CENTROS C, PROFESORES P
WHERE C.COD_CENTRO + ESPECIALIDAD ;

2.
SELECT P.APELLIDOS, P.ESPECIALIDAD,C.COD_CENTRO,C.DIRECCION,A.NUMEROAULA,A.CANTIDADHORAS
FROM PROFESORES P,CENTROS C,AULAS A;

3.
SELECT AVG(CANTIDADHORAS), MIN(NUMEROAULA)
FROM AULAS;

4.
UPDATE AULAS
SET CANTIDADHORAS = CANTIDADHORAS / 100 * 20;

SELECT * FROM AULAS;

5.
INSERT INTO CENTROS(COD_CENTRO,TIPO_CENTRO,NOMBRE,DIRECCION,TELEFONO,NUM_PLAZAS)
VALUES (55, (SELECT TIPO_CENTRO,NOMBRE,DIRECCION,TELEFONO FROM CENTROS WHERE NOMBRE ='CP Manuel Hidalgo') ,100);


6.
UPDATE CENTROS
SET TIPO_CENTRO = 'X'
WHERE NUM_PLAZAS > 300;

SELECT * FROM AULAS;

7.
DELETE FROM PROFESORES 
WHERE COD_CENTRO = (select COD_CENTRO from AULAS where COD_CENTRO IS NULL);